---
title: "RAD-Median and Trimmed Mean"
author: "Isaac Rankin"
date: "2024-11-02"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
library(ggplot2)
```



# Function to Compute the RAD-Median and Trimmed Mean

```{r function}
TRIMMEDmean = function(X, TRIM_Remain = 1, distance_type = "euclidean") { 
  # X is a matrix of point coordinates
  # TRIM_Remain is the minimum number of points to be kept 
  # p must be greater or equal to 2 

  n = nrow(X) # number of observations 
  p = ncol(X) # dimension of data 
  rownames(X) = paste0(rep("x", n), 1:n) # xi is observation 1 
  colnames(X) = paste0(rep("c", p), 1:p) # ci is coordinate i 

  # Check for valid distance type
  valid_distance_types = c("euclidean", "manhattan", "maximum", "canberra", "binary", "minkowski")
  if (!(distance_type %in% valid_distance_types)) {
    message(paste("Invalid distance type selected. Supported types are:", 
                  paste(valid_distance_types, collapse = ", ")))
    return(NULL)  # Return NULL if the distance type is invalid
  }

  # If all points are kept, return the regular mean 
  if (TRIM_Remain == n) { 
    return(colMeans(X)) 
  } 

  # Matrix of pairwise distances using the specified distance type
  D = as.matrix(dist(X, method = distance_type))
  colnames(D) = paste0(rep("x", n), 1:n) 
  rownames(D) = paste0(rep("x", n), 1:n) 

  # Find points for trimmed mean or median 
  points = n # initially have n points 
  prev_points = n # number of points in previous iteration 
  POINTS_to_use = 0 

  # Iteratively remove points
  while (points > TRIM_Remain) { 
    Prev = D 
    prev_points = ncol(Prev) 
    
    #### Handle the single point median case separately 
    if (points == 3 & TRIM_Remain == 1) { 
      three_points = rownames(D) 
      farthest = which(D == max(D), arr.ind = TRUE) 
      last_point = three_points[!(three_points %in% rownames(farthest))] 

      ## If all the last three points have farthest distance 
      if (length(last_point) == 0) { 
        POINTS_to_use = rownames(Prev) 
        break 
      } 
      ## 
      cat("The RAD-Median is:", last_point, "\n")
      return(X[last_point,]) 
    } 
    #####

    farthest = which(D == max(D), arr.ind = TRUE) 
    D = D[!(rownames(D) %in% rownames(farthest)), !(colnames(D) %in% rownames(farthest))] 
    points = max(ncol(D), 0) 

    # Ensure that the number of points kept is the fewest possible while at least TRIM_Remain
    if (points == TRIM_Remain) { 
      POINTS_to_use = rownames(D) 
      break 
    } else if (points < TRIM_Remain) { 
      POINTS_to_use = rownames(Prev) 
      break 
    } 
  } 

  n_use = length(POINTS_to_use) 
  points_in_mean = rep(0, n_use) 
  for (a in 1:n_use) { 
    points_in_mean[a] = which(rownames(X) == POINTS_to_use[a]) 
  } 

  mean_of_points = colMeans(X[points_in_mean,]) 
  print("The points used to compute the Trimmed-mean are:") 
  print(X[points_in_mean,]) 
  print("The Trimmed mean is:") 
  return(mean_of_points) 
}
```



# Examples

Create an example dataset with 101 5-dimensional observations
```{r dataset_examples}
set.seed(1)
n = 101 # n is the number of observations
p = 5 # p is the number of coordinates of each observation
Sample_data = matrix(data = rnorm(n*p, mean = 0, sd = 10), nrow = n, ncol = p)
```


Compute the RAD-Median using Euclidean distance
```{r ex1}
TRIMMEDmean(Sample_data, TRIM_Remain = 1, distance_type = "euclidean")
```

Compute the Trimmed-Mean using Euclidean distance

```{r ex2}
TRIMMEDmean(Sample_data, TRIM_Remain = 4, distance_type = "euclidean")
```
Compute the RAD-Median using Manhattan distance
```{r ex3}
TRIMMEDmean(Sample_data, TRIM_Remain = 1, distance_type = "manhattan")
```

Demonstrate the supported distances
```{r ex4}
TRIMMEDmean(Sample_data, TRIM_Remain = 1, distance_type = "?")
```


# Example for 2-dimensional data, n odd

```{r dataset_odd}
# Create the dataset
set.seed(123456) 
n = 5 # n is the number of observations
X <- matrix(data = runif(n = 2*n, min = 0, max = 10), nrow = n, ncol = 2, byrow = TRUE)

# Set row names as x1, x2, ...
rownames(X) <- paste0("x", 1:nrow(X))

# Set column names as c1, c2, ...
colnames(X) <- paste0("c", 1:ncol(X))

# Prepare data for plotting
plot_data <- as.data.frame(X)
plot_data$Point <- rownames(plot_data)  # Add point names for labels
```

```{r ex_odd}
# Compute the TRIMMEDmean
trimmed_mean_result <- TRIMMEDmean(X, TRIM_Remain = 1, distance_type = "euclidean")

# Plot the points and TRIMMEDmean
suppressWarnings({
  p <- ggplot(plot_data, aes(x = c1, y = c2)) +
    geom_point(color = "grey", size = 3) +  # Original points
    geom_point(aes(x = trimmed_mean_result[1], y = trimmed_mean_result[2]), 
               color = "red", shape = 5, size = 4, stroke = 1) +  # Trimmed mean point
    xlab("Coordinate 1") +
    ylab("Coordinate 2") +
    theme_minimal(base_size = 15) +
    theme(
      axis.title.x = element_text(size = 14, face = "bold"),  # Larger x-axis title
      axis.title.y = element_text(size = 14, face = "bold"),  # Larger y-axis title
      axis.text.x = element_text(size = 12),  # Larger x-axis text
      axis.text.y = element_text(size = 12),  # Larger y-axis text
      axis.line = element_line(colour = "black"),  # Add axis lines
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      panel.border = element_blank()
    ) +
    geom_text(aes(label = Point), hjust = 1.5, vjust = 0, size = 4) +
    coord_fixed(ratio = 1) +  # Fixed aspect ratio
    scale_x_continuous(expand = c(0, 0),
                       limits = c(0, 11)) +  # Set x-axis to start from 0
    scale_y_continuous(expand = c(0, 0),
                       limits = c(0, 11))   # Set y-axis to start from 0
    print(p)
})

```

# Example for 2-dimensional data, n even

```{r dataset_even}
# Create the dataset
set.seed(2024) 
n = 10 # n is the number of observations
X <- matrix(data = runif(n = 2*n, min = 0, max = 10), nrow = n, ncol = 2, byrow = TRUE)

# Set row names as x1, x2, ...
rownames(X) <- paste0("x", 1:nrow(X))

# Set column names as c1, c2, ...
colnames(X) <- paste0("c", 1:ncol(X))

# Prepare data for plotting
plot_data <- as.data.frame(X)
plot_data$Point <- rownames(plot_data)  # Add point names for labels
```


```{r ex_even}
# Compute the TRIMMEDmean
trimmed_mean_result <- TRIMMEDmean(X, TRIM_Remain = 1, distance_type = "euclidean")

# Plot the points and TRIMMEDmean
suppressWarnings({
  p <- ggplot(plot_data, aes(x = c1, y = c2)) +
    geom_point(color = "grey", size = 3) +  # Original points
    geom_point(aes(x = trimmed_mean_result[1], y = trimmed_mean_result[2]), 
               color = "red", shape = 5, size = 4, stroke = 1) +  # Trimmed mean point
    xlab("Coordinate 1") +
    ylab("Coordinate 2") +
    theme_minimal(base_size = 15) +
    theme(
      axis.title.x = element_text(size = 14, face = "bold"),  # Larger x-axis title
      axis.title.y = element_text(size = 14, face = "bold"),  # Larger y-axis title
      axis.text.x = element_text(size = 12),  # Larger x-axis text
      axis.text.y = element_text(size = 12),  # Larger y-axis text
      axis.line = element_line(colour = "black"),  # Add axis lines
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      panel.border = element_blank()
    ) +
    geom_text(aes(label = Point), hjust = 1.5, vjust = 0, size = 4) +
    coord_fixed(ratio = 1) +  # Fixed aspect ratio
    scale_x_continuous(expand = c(0, 0),
                       limits = c(0, 11)) +  # Set x-axis to start from 0
    scale_y_continuous(expand = c(0, 0),
                       limits = c(0, 11))   # Set y-axis to start from 0
    print(p)
})

```

# Manhattan distance is not rotationally invariant
```{r dataset_triangle}
# Define the data matrix
triangle_data <- matrix(data = c(0, 0, 
                                  0, 1, 
                                  sqrt(3), 0), 
                         nrow = 3, ncol = 2, byrow = TRUE)

# Set row names as x1, x2, ...
rownames(triangle_data) <- paste0("x", 1:nrow(triangle_data))

# Set column names as c1, c2, ...
colnames(triangle_data) <- paste0("c", 1:ncol(triangle_data))

# Define the rotation angle (pi/6)
theta <- pi / 6

# Define the rotation matrix
rotation_matrix <- matrix(c(cos(theta), -sin(theta), 
                             sin(theta), cos(theta)), 
                          nrow = 2, byrow = TRUE)

# Rotate each point by applying the rotation matrix
rotated_data <- triangle_data %*% t(rotation_matrix)

# Set column names as c1, c2, ...
colnames(rotated_data) <- paste0("c", 1:ncol(rotated_data))

# Prepare data for plotting
plot_data_triangle <- as.data.frame(triangle_data)
plot_data_triangle$Point <- rownames(plot_data_triangle)  # Add point names for labels

plot_data_rotated <- as.data.frame(rotated_data)
plot_data_rotated$Point <- rownames(plot_data_rotated)  # Add point names for labels
```

RAD-Median for original data
```{r original_RAD}
TRIMMEDmean(triangle_data, TRIM_Remain = 1, distance_type = "manhattan")
```

RAD-Median for rotated data
```{r rotated_RAD}
TRIMMEDmean(rotated_data, TRIM_Remain = 1, distance_type = "manhattan")
```

Plot of RAD-Median for original data
```{r plot_original}
# Compute the TRIMMEDmean
trimmed_mean_result <- TRIMMEDmean(triangle_data, TRIM_Remain = 1, distance_type = "manhattan")

# Plot the points and TRIMMEDmean
suppressWarnings({
  p <- ggplot(plot_data_triangle, aes(x = c1, y = c2)) +
    geom_point(color = "grey", size = 3) +  # Original points
    geom_point(aes(x = trimmed_mean_result[1], y = trimmed_mean_result[2]), 
               color = "red", shape = 5, size = 4, stroke = 1) +  # Trimmed mean point
    xlab("Coordinate 1") +
    ylab("Coordinate 2") +
    theme_minimal(base_size = 15) +
    theme(
      axis.title.x = element_text(size = 14, face = "bold"),  # Larger x-axis title
      axis.title.y = element_text(size = 14, face = "bold"),  # Larger y-axis title
      axis.text.x = element_text(size = 12),  # Larger x-axis text
      axis.text.y = element_text(size = 12),  # Larger y-axis text
      axis.line = element_line(colour = "black"),  # Add axis lines
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      panel.border = element_blank()
    ) +
    geom_text(aes(label = Point), hjust = 1.5, vjust = 0, size = 4) +
    coord_fixed(ratio = 1) +  # Fixed aspect ratio
    scale_x_continuous(expand = c(0, 0),
                       limits = c(-2, 2)) +  
    scale_y_continuous(expand = c(0, 0),
                       limits = c(-1, 2))   
    print(p)
})

```

Plot of RAD-Median for rotated data
```{r plot_rotated}
# Compute the TRIMMEDmean
trimmed_mean_result <- TRIMMEDmean(rotated_data, TRIM_Remain = 1, distance_type = "manhattan")

# Plot the points and TRIMMEDmean
suppressWarnings({
  p <- ggplot(plot_data_rotated, aes(x = c1, y = c2)) +
    geom_point(color = "grey", size = 3) +  # Original points
    geom_point(aes(x = trimmed_mean_result[1], y = trimmed_mean_result[2]), 
               color = "red", shape = 5, size = 4, stroke = 1) +  # Trimmed mean point
    xlab("Coordinate 1") +
    ylab("Coordinate 2") +
    theme_minimal(base_size = 15) +
    theme(
      axis.title.x = element_text(size = 14, face = "bold"),  # Larger x-axis title
      axis.title.y = element_text(size = 14, face = "bold"),  # Larger y-axis title
      axis.text.x = element_text(size = 12),  # Larger x-axis text
      axis.text.y = element_text(size = 12),  # Larger y-axis text
      axis.line = element_line(colour = "black"),  # Add axis lines
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      panel.border = element_blank()
    ) +
    geom_text(aes(label = Point), hjust = 1.5, vjust = 0, size = 4) +
    coord_fixed(ratio = 1) +  # Fixed aspect ratio
    scale_x_continuous(expand = c(0, 0),
                       limits = c(-2, 2)) +  
    scale_y_continuous(expand = c(0, 0),
                       limits = c(-1, 2))   
    print(p)
})

```



